<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="DPMUnc">
<title>DPMUnc • DPMUnc</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="DPMUnc">
<meta property="og:description" content="DPMUnc">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">DPMUnc</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item">
  <a class="nav-link" href="../articles/DPMUnc.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-article">

<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>DPMUnc</h1>
            
      
      
      <div class="d-none name"><code>DPMUnc.Rmd</code></div>
    </div>

    
    
<p>This is a brief vignette into how to use the DPMUnc package, which implements the model described in &gt; Bayesian clustering with uncertain data &gt; Kath Nicholls, Paul D W Kirk, Chris Wallace &gt; doi: <a href="https://doi.org/10.1101/2022.12.07.519476" class="external-link uri">https://doi.org/10.1101/2022.12.07.519476</a></p>
<p>First, we simulate some data. 50 observations over 5 dimensions which fall into 4 classes. The different classes have different means, and each observation has its own mean value which is the class mean + some Gaussian noise. Finally each observation has some observed variance (obsVars) and its observed value (obsData) is the observation mean + Gaussian noise described by obsVars. The plot shows these 3 matrices - class mean on the left, observation mean in the middle, and observed data on the right. The colour on the left indicates the true class.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">DPMUnc</span><span class="op">)</span></span>
<span>  <span class="va">n</span> <span class="op">=</span> <span class="fl">50</span>; <span class="va">d</span> <span class="op">=</span> <span class="fl">5</span>; <span class="va">k</span> <span class="op">=</span> <span class="fl">4</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">42</span><span class="op">)</span></span>
<span> <span class="va">classes</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">k</span>, <span class="va">n</span>, replace<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span> <span class="va">group_means</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">classes</span>, <span class="va">d</span><span class="op">)</span>, <span class="va">n</span>, <span class="va">d</span><span class="op">)</span></span>
<span> <span class="va">observation_means</span> <span class="op">=</span> <span class="va">group_means</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n</span><span class="op">*</span><span class="va">d</span>, sd<span class="op">=</span><span class="fl">0.2</span><span class="op">)</span>,<span class="va">n</span>,<span class="va">d</span><span class="op">)</span></span>
<span> <span class="va">obsVars</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Chisquare.html" class="external-link">rchisq</a></span><span class="op">(</span><span class="va">n</span><span class="op">*</span><span class="va">d</span>,<span class="fl">1</span><span class="op">)</span>, <span class="va">n</span>, <span class="va">d</span><span class="op">)</span></span>
<span> <span class="va">obsData</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n</span><span class="op">*</span><span class="va">d</span>, mean<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">as.vector</a></span><span class="op">(</span><span class="va">observation_means</span><span class="op">)</span>, sd<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">as.vector</a></span><span class="op">(</span><span class="va">obsVars</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>, <span class="va">n</span>, <span class="va">d</span><span class="op">)</span></span>
<span><span class="va">cols</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"#0173B2"</span>, <span class="st">"#029E73"</span>, <span class="st">"#D55E00"</span>, <span class="st">"#CC78BC"</span>, <span class="st">"#ECE133"</span>, <span class="st">"#56B4E9"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/heatmap.html" class="external-link">heatmap</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">group_means</span>,<span class="cn">NA</span>,<span class="va">observation_means</span>,<span class="cn">NA</span>,<span class="va">obsData</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/order.html" class="external-link">order</a></span><span class="op">(</span><span class="va">classes</span><span class="op">)</span>,<span class="op">]</span>, Rowv<span class="op">=</span><span class="cn">NA</span>, Colv<span class="op">=</span><span class="cn">NA</span>, scale<span class="op">=</span><span class="st">"none"</span>,RowSideColors<span class="op">=</span><span class="va">cols</span><span class="op">[</span><span class="va">classes</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/order.html" class="external-link">order</a></span><span class="op">(</span><span class="va">classes</span><span class="op">)</span><span class="op">]</span><span class="op">]</span>,ylab<span class="op">=</span><span class="st">"samples"</span>, xlab<span class="op">=</span><span class="st">"dimensions"</span>,labRow<span class="op">=</span><span class="va">classes</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/order.html" class="external-link">order</a></span><span class="op">(</span><span class="va">classes</span><span class="op">)</span><span class="op">]</span>,labCol<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"CM"</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">)</span>,<span class="st">""</span>,<span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"OM"</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">)</span>,<span class="st">""</span>,<span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"OD"</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="DPMUnc_files/figure-html/sim-1.png" width="768"></p>
<p>This sounds like a complicated structure, but the first two matrices are assumed to exist for any regular clustering problem, the first being the cluster means and the second the observations. The more complicated data structure described here might occur when you average multiple noisy measurements - eg if you took repeated measures of blood pressure and pulse, and summarised by their mean this would be the observed data matrix, with the observation mean assumed latent. This model allows you to include information about the variability of those measurements to assist in inference.</p>
<p>DPMUnc requires some hyperparameters to be specified. We have found the following generally applicable, but do check if you get nonsensical results.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span> <span class="co"># The hyperparameters</span></span>
<span> <span class="va">alpha0</span> <span class="op">=</span> <span class="fl">2</span>; <span class="va">beta0</span> <span class="op">=</span> <span class="fl">0.2</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">obsData</span>, <span class="fl">2</span>, <span class="va">var</span><span class="op">)</span><span class="op">)</span>; <span class="va">kappa0</span> <span class="op">=</span> <span class="fl">0.5</span></span>
<span><span class="co"># the directory to store output</span></span>
<span><span class="va">td</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"DPMUnc"</span><span class="op">)</span></span></code></pre></div>
<p>Run DPMUnc, only 2 chains and a short number of iterations (<code>nIts</code>). This is not how we would run in the wild, where we expect at least 3 chains at 10,000 iterations - more if needed for convergence.</p>
<p>We set <code>nCores=1</code> to save processing power too, but by default, if you have the capacity, this would be set to nChains for speed.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span> <span class="fu"><a href="../reference/DPMUnc.html">DPMUnc</a></span><span class="op">(</span><span class="va">obsData</span>, <span class="va">obsVars</span>, saveFileDir<span class="op">=</span><span class="va">td</span>, seed<span class="op">=</span><span class="fl">1</span>, nChains<span class="op">=</span><span class="fl">2</span>, nCores<span class="op">=</span><span class="fl">1</span>,</span>
<span>        kappa0<span class="op">=</span><span class="va">kappa0</span>, alpha0<span class="op">=</span><span class="va">alpha0</span>, beta0<span class="op">=</span><span class="va">beta0</span>, nIts<span class="op">=</span><span class="fl">100</span><span class="op">)</span> </span></code></pre></div>
<p>Look at the structure of the output. You may never need this, but included here in case you do:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span><span class="va">td</span><span class="op">)</span> <span class="co"># one directory per chain</span></span>
<span><span class="co">#&gt; [1] "1" "2"</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">td</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="co"># outputs for each chain</span></span>
<span><span class="co">#&gt; [1] "alpha.csv"                 "clusterAllocations.csv"   </span></span>
<span><span class="co">#&gt; [3] "clusterMeans.csv"          "clusterVars.csv"          </span></span>
<span><span class="co">#&gt; [5] "K.csv"                     "latentObservations.csv"   </span></span>
<span><span class="co">#&gt; [7] "pLatentsGivenClusters.csv"</span></span></code></pre></div>
<p>You will look at the chains for convergence. You are looking for lines moving about a stationary distribution (ie the mean doesn’t keep changing) and that the different colour lines are all in about the same place. You can’t really tell here with only 5 stored samples (we ran 100 iterations, but DPMUnc thins samples to save only 10% of them, to limit autocorrelation, and then we discarded the first 50% as burnin). Typically you would have many more samples to make this judgement on. For now, we will proceed as if the chains had converged (if they hadn’t, you would need to rerun with higher <code>nIts</code>).</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mcmc</span><span class="op">=</span><span class="fu"><a href="../reference/read_samples.html">read_samples</a></span><span class="op">(</span><span class="va">td</span>, burnin<span class="op">=</span><span class="fl">.5</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">mcmc</span><span class="op">)</span></span></code></pre></div>
<p><img src="DPMUnc_files/figure-html/plots-1.png" width="768"></p>
<p>We process the posterior similarity matrix (PSM) to call clusters using mcclust’s maxpear function. From the plot, the PSM has captured the true class structure pretty well. But when we use maxpear to summarise the PSM, it “sees” only 3 classes, choosing to combine classes 3 and 4 (pink and orange). Not great, but not bad for only 100 iterations.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span>    <span class="va">psm</span><span class="op">=</span><span class="fu"><a href="../reference/get_psm.html">get_psm</a></span><span class="op">(</span><span class="va">td</span>, trim<span class="op">=</span><span class="fl">.5</span><span class="op">)</span> <span class="co"># posterior similarity matrix, discarding first 50% of each run as burn in</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/heatmap.html" class="external-link">heatmap</a></span><span class="op">(</span><span class="va">psm</span>, RowSideColors<span class="op">=</span><span class="va">cols</span><span class="op">[</span><span class="va">classes</span><span class="op">]</span>,ylab<span class="op">=</span><span class="st">"samples"</span>, xlab<span class="op">=</span><span class="st">"dimensions"</span>,labRow<span class="op">=</span><span class="va">classes</span>, Colv<span class="op">=</span><span class="cn">NA</span><span class="op">)</span></span></code></pre></div>
<p><img src="DPMUnc_files/figure-html/psm-1.png" width="768"></p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">clusters</span><span class="op">=</span><span class="fu">mcclust</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/mcclust/man/maxpear.html" class="external-link">maxpear</a></span><span class="op">(</span><span class="va">psm</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span>inferred<span class="op">=</span><span class="va">clusters</span><span class="op">$</span><span class="va">cl</span>, truth<span class="op">=</span><span class="va">classes</span><span class="op">)</span></span>
<span><span class="co">#&gt;         truth</span></span>
<span><span class="co">#&gt; inferred  1  2  3  4</span></span>
<span><span class="co">#&gt;        1 14  3  0  0</span></span>
<span><span class="co">#&gt;        2  0 11  1  0</span></span>
<span><span class="co">#&gt;        3  0  0  8 13</span></span></code></pre></div>
<p>It is also arguably better than if we had simply used hierarchical clustering of the observed data ignoring the associated observed variance.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/heatmap.html" class="external-link">heatmap</a></span><span class="op">(</span><span class="va">obsData</span>, RowSideColors<span class="op">=</span><span class="va">cols</span><span class="op">[</span><span class="va">classes</span><span class="op">]</span>,ylab<span class="op">=</span><span class="st">"samples"</span>, xlab<span class="op">=</span><span class="st">"dimensions"</span>,labRow<span class="op">=</span><span class="va">classes</span>, Colv<span class="op">=</span><span class="cn">NA</span><span class="op">)</span></span></code></pre></div>
<p><img src="DPMUnc_files/figure-html/hier-1.png" width="768"></p>
<p>Finally, it is good practice to clear up the temporary directory for a vignette.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/unlink.html" class="external-link">unlink</a></span><span class="op">(</span><span class="va">td</span>, recursive<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
  </main>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Chris Wallace.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
